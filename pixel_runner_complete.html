<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pixel Runner — Pixel Art Edition (Star Mode + Refined Audio + Fewer Lives)</title>
  <style>
    :root{ --bg:#0b1020;--fg:#e6f1ff;--accent:#66e0ff;--good:#9cff57;--bad:#ff5470;--muted:#9aa6b2;--panel:#121a33;--gold:#ffd166 }
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#0a0f1f 0%,#0b1020 100%);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;color:var(--fg)}
    .wrap{display:grid;place-items:center;height:100%;padding:1rem;box-sizing:border-box}
    canvas#game{background:radial-gradient(1200px 800px at 50% 20%, #101a36 0%, #0b1020 60%, #090e1b 100%);border:1px solid #1c2855;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.45);max-width:100%;height:auto}
    .logo-top-wrap{ position:fixed; top:48px; left:50%; transform:translateX(-50%); width:min(900px, 94vw); pointer-events:none; z-index:5; display:flex; justify-content:center; }
    canvas#logoTop{ width:100%; height:80px; image-rendering:pixelated; }
    .hud{position:fixed;inset:0;display:flex;align-items:flex-start;justify-content:center;pointer-events:none;z-index:10}
    .hud-inner{width:min(980px,100%);padding:8px 12px;display:flex;gap:12px;justify-content:space-between;flex-wrap:wrap}
    .pill{background:rgba(18,26,51,.8);backdrop-filter:blur(4px);border:1px solid #233160;border-radius:999px;padding:.35rem .8rem;font-weight:600;color:var(--fg)}
    .pill em{font-style:normal;color:var(--accent)}
    .pill.flash{animation:flashPulse .6s ease-out 1}
    @keyframes flashPulse{ 0%{box-shadow:0 0 0 rgba(0,0,0,0)} 25%{box-shadow:0 0 22px rgba(156,255,87,.45)} 100%{box-shadow:0 0 0 rgba(0,0,0,0)} }
    .intro-ui{ position:absolute; left:50%; transform:translateX(-50%); top:calc(50% + 120px); display:flex; gap:10px; align-items:center; z-index:6; pointer-events:auto; flex-wrap:wrap; justify-content:center; }
    .btn{background:linear-gradient(180deg,#67e8f9,#22d3ee);color:#00111a;font-weight:800;border:none;border-radius:12px;padding:.9rem 1.2rem;cursor:pointer;box-shadow:0 6px 18px rgba(34,211,238,.35)}
    .btn.secondary{background:linear-gradient(180deg,#c7d2fe,#818cf8)}
    .kbd{font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;background:#0f162d;border:1px solid #233160;border-radius:6px;padding:.15rem .35rem}
    .overlay{position:fixed;inset:0;display:none;place-items:center;background:rgba(7,10,20,.6);backdrop-filter:blur(3px);z-index:9999}
    .overlay[aria-hidden="false"]{display:grid}
    .card{background:var(--panel);border:1px solid #253362;border-radius:14px;box-shadow:0 10px 30px rgba(0,0,0,.45);padding:20px;max-width:860px;width:clamp(300px,90vw,860px)}
    h1{margin:.2rem 0 .4rem;font-size:1.8rem;letter-spacing:.3px}
    .subtitle{color:var(--muted);margin:.2rem 0 1rem;font-size:.95rem}
    .row{display:flex;flex-wrap:wrap;gap:10px}
    [hidden]{display:none !important}
    .scoreboard{ display:grid; grid-template-columns:repeat(auto-fit,minmax(140px,1fr)); gap:10px; margin:12px 0 8px; }
    .tile{ background:linear-gradient(180deg,#0f1732,#0d1430); border:1px solid #223060; border-radius:12px; padding:10px; text-align:center; }
    .tile .label{ color:var(--muted); font-size:.85rem }
    .tile .value{ font-weight:800; font-size:1.3rem; margin-top:2px; color:var(--fg) }
    .rank{ display:flex; align-items:center; justify-content:center; gap:10px; margin-top:6px; padding:10px; border:1px dashed #2a3a72; border-radius:12px; background:rgba(102,224,255,.06) }
    .legend{ position:fixed; top:0; right:0; height:100%; max-width:300px; width:86vw; background:rgba(12,18,40,.84); backdrop-filter:blur(6px); border-left:1px solid #24325f; box-shadow:-10px 0 30px rgba(0,0,0,.35); transform:translateX(110%); transition:transform .45s cubic-bezier(.22,1,.36,1); z-index:50; display:flex; flex-direction:column; padding:14px 14px 18px; gap:10px; }
    .legend.in{ transform:translateX(0%); }
    .legend h3{ margin:.2rem 0 .2rem; font-size:1.1rem; letter-spacing:.2px }
    .legend .item{ display:flex; align-items:center; gap:10px; padding:8px; border:1px solid #223060; border-radius:10px; background:#0f1732 }
    .legend .item canvas{ width:40px; height:40px; image-rendering:pixelated; border-radius:6px; background:#0c132a }
    .legend small{ color:var(--muted) }
    .legend .sep{ height:1px; background:#20305e; margin:4px 0 }
    .float-panel{ position:fixed; left:50%; transform:translateX(-50%); bottom:24px; z-index:6; background:rgba(12,18,40,.88); border:1px solid #253362; border-radius:12px; padding:12px; width:min(900px, 94vw); display:none; }
    .float-panel.open{ display:block; }
    .legend-inline{ display:grid; grid-template-columns:repeat(auto-fit,minmax(180px,1fr)); gap:10px; }
    .legend-inline .item{ display:flex; align-items:center; gap:10px; padding:8px; border:1px solid #223060; border-radius:10px; background:#0f1732 }
    .legend-inline .item canvas{ width:34px; height:34px; image-rendering:pixelated; border-radius:6px; background:#0c132a }
    .popup-layer{ position:fixed; pointer-events:none; inset:0; z-index:6 }
  </style>
</head>
<body>
  <div class="logo-top-wrap"><canvas id="logoTop" width="900" height="90" aria-hidden="true"></canvas></div>

  <div class="wrap">
    <canvas id="game" width="900" height="600" aria-label="Game canvas"></canvas>

    <div id="introUI" class="intro-ui">
      <button id="instBtn" class="btn secondary" type="button" aria-expanded="false" aria-controls="instPanel">Instructions</button>
      <button id="loreBtn" class="btn secondary" type="button" aria-expanded="false" aria-controls="lorePanel">Lore</button>
      <button id="startBtn" class="btn" type="button">Play</button>
    </div>
  </div>

  <div class="popup-layer" aria-hidden="true"></div>

  <div class="hud"><div class="hud-inner">
    <div class="pill" id="pillScore">Score: <em id="score">0</em></div>
    <div class="pill" id="pillLives">Lives: <em id="lives">3</em></div>
    <div class="pill" id="pillTime">Time: <em id="time">0.0s</em></div>
    <div class="pill" id="pillBombs">Bombs: <em id="bombs">0</em></div>
    <div class="pill" id="pillCombo">Combo: <em id="combo">x1.0</em></div>
    <div class="pill" id="pillStar">Star: <em id="star">—</em></div>
    <div class="pill">Best: <em id="best">0</em></div>
  </div></div>

  <aside id="legend" class="legend" aria-label="Legend panel">
    <h3>Legend</h3>
    <div class="item"><canvas width="64" height="64" data-icon="player"></canvas><div><strong>You</strong><br><small>Move, dash, collect.</small></div></div>
    <div class="item"><canvas width="64" height="64" data-icon="orb"></canvas><div><strong>Pixel Orb</strong><br><small>+10 points, builds combo.</small></div></div>
    <div class="item"><canvas width="64" height="64" data-icon="spike"></canvas><div><strong>Spike</strong><br><small>Avoid or lose a life.</small></div></div>
    <div class="item"><canvas width="64" height="64" data-icon="bomb"></canvas><div><strong>Bomb Pickup</strong><br><small>Press <span class="kbd">Space</span> to blast.</small></div></div>
    <div class="item"><canvas width="64" height="64" data-icon="star"></canvas><div><strong>Star Orb</strong><br><small>Enter <em>Star Mode</em>: invincible, faster, rainbow trail.</small></div></div>
    <div class="sep"></div>
    <small>Tip: Dashing (<span class="kbd">Shift</span>) gives speed bursts.</small>
  </aside>

  <div id="overlay" class="overlay" aria-hidden="true">
    <div id="pauseCard" class="card" hidden>
      <h1>Paused</h1>
      <div class="row" style="justify-content:flex-end">
        <button id="resumeBtn" class="btn" type="button">Resume</button>
        <button id="restartFromPauseBtn" class="btn secondary" type="button">Restart</button>
      </div>
    </div>

    <div id="gameoverCard" class="card" hidden>
      <h1>Game Over</h1>
      <div class="subtitle" id="goSubtitle"></div>
      <div class="scoreboard">
        <div class="tile"><div class="label">Score</div><div class="value" id="sbScore">0</div></div>
        <div class="tile"><div class="label">Best</div><div class="value" id="sbBest">0</div></div>
        <div class="tile"><div class="label">Time</div><div class="value" id="sbTime">0.0s</div></div>
        <div class="tile"><div class="label">Max Combo</div><div class="value" id="sbCombo">x1.0</div></div>
        <div class="tile"><div class="label">Orbs Collected</div><div class="value" id="sbOrbs">0</div></div>
        <div class="tile"><div class="label">Bombs Used</div><div class="value" id="sbBombs">0</div></div>
        <div class="tile"><div class="label">Hits Taken</div><div class="value" id="sbHits">0</div></div>
      </div>
      <div class="rank"><strong id="sbRank">Rank: Pixel Newcomer</strong></div>
      <div class="row" style="justify-content:space-between; align-items:center; margin-top:10px">
        <div style="max-width:520px; color:var(--muted); font-size:.95rem" id="goLoreTeaser">
          In the Neon Drift, pixels aren’t just light — they’re citizens. You’re a Runner, a courier for the Archivist, ferrying living data through glitched star‑lanes while rogue Arrows hunt anything that moves.
        </div>
        <div class="row">
          <button id="playAgainBtn" class="btn" type="button">Play Again</button>
        </div>
      </div>
    </div>
  </div>

  <div id="instPanel" class="float-panel" role="region" aria-label="Instructions and legend">
    <div class="row" style="justify-content:space-between;align-items:center">
      <div class="row" style="gap:8px">
        <div class="pill">Move: <span class="kbd">W</span><span class="kbd">A</span><span class="kbd">S</span><span class="kbd">D</span> / Arrows</div>
        <div class="pill">Dash: <span class="kbd">Shift</span></div>
        <div class="pill">Bomb: <span class="kbd">Space</span></div>
        <div class="pill">Pause: <span class="kbd">P</span></div>
        <div class="pill">Restart: <span class="kbd">R</span></div>
      </div>
      <div class="pill" style="cursor:pointer" id="closeInst">Close ✕</div>
    </div>
    <div class="legend-inline" style="margin-top:10px">
      <div class="item"><canvas width="60" height="60" data-icon="player"></canvas><div><strong>You</strong><br><small>Collect, dodge, survive.</small></div></div>
      <div class="item"><canvas width="60" height="60" data-icon="orb"></canvas><div><strong>Pixel Orb</strong><br><small>+10, increases <em>Combo</em>.</small></div></div>
      <div class="item"><canvas width="60" height="60" data-icon="spike"></canvas><div><strong>Spike</strong><br><small>Hazard. Costs a life.</small></div></div>
      <div class="item"><canvas width="60" height="60" data-icon="bomb"></canvas><div><strong>Bomb Pickup</strong><br><small>Press <span class="kbd">Space</span> to clear spikes.</small></div></div>
      <div class="item"><canvas width="60" height="60" data-icon="star"></canvas><div><strong>Star Orb</strong><br><small><em>Star Mode</em>: invincible, faster, rainbow trail.</small></div></div>
    </div>
    <div style="width:100%;color:var(--muted);font-size:.95rem;margin-top:8px">
      Score quickly to keep your <strong>Combo</strong> climbing (max x5). Bombs wipe nearby spikes and create a huge pixel blast. <strong>Star Mode</strong> lasts a short time — crash through hazards while it shines.
    </div>
  </div>

  <div id="lorePanel" class="float-panel" role="region" aria-label="Lore">
    <div class="row" style="justify-content:space-between;align-items:center">
      <h3 style="margin:0">Lore: Runners of the Neon Drift</h3>
      <div class="pill" style="cursor:pointer" id="closeLore">Close ✕</div>
    </div>
    <div style="margin-top:8px; line-height:1.35">
      <p><strong>Pixels are people.</strong> In the Neon Drift — a shattered data‑galaxy — each pixel is a tiny citizen carrying memory, music, and map‑fragments of lost worlds. They gather into Orbs to travel safely between serverscape islands.</p>
      <p><strong>You are a Runner</strong>, a courier working for the Archivist. Your job is to guide Orbs through hostile lanes, dodging rogue <em>Arrows</em> — corrupted seek‑and‑delete routines that evolved predatory instincts.</p>
      <p><strong>Bombs</strong> are rescue flares: compressed rollback packets that unravel nearby corruption with a brilliant detonation of color. Use them wisely — every blast costs precious energy and time.</p>
      <p><strong>Combos</strong> represent sync with the Drift. The closer your rhythm, the more the world rewards you — until the Arrows notice and the hunt intensifies.</p>
    </div>
  </div>

<script>


(function(){
  const game = document.getElementById('game'), ctx = game.getContext('2d');
  const logoTop = document.getElementById('logoTop'), tctx = logoTop.getContext('2d');
  const DPR = Math.max(1, Math.min(2, window.devicePixelRatio||1)); let W=game.width, H=game.height;

  // HUD
  const $ = id => document.getElementById(id);
  const scoreEl=$('score'), livesEl=$('lives'), timeEl=$('time'), bombsEl=$('bombs'),
        comboEl=$('combo'), starEl=$('star'), bestEl=$('best'),
        pillLives=$('pillLives'), pillBombs=$('pillBombs');

  // Panels/Buttons
  const overlay=$('overlay'), pauseCard=$('pauseCard'), gameoverCard=$('gameoverCard');
  const resumeBtn=$('resumeBtn'), restartFromPauseBtn=$('restartFromPauseBtn'), playAgainBtn=$('playAgainBtn');
  const legendPanel=$('legend'), introUI=$('introUI'), startBtn=$('startBtn');
  const instBtn=$('instBtn'), instPanel=$('instPanel'), closeInst=$('closeInst');
  const loreBtn=$('loreBtn'), lorePanel=$('lorePanel'), closeLore=$('closeLore');

  // Scoreboard fields
  const sbScore=$('sbScore'), sbBest=$('sbBest'), sbTime=$('sbTime'), sbCombo=$('sbCombo'),
        sbOrbs=$('sbOrbs'), sbBombs=$('sbBombs'), sbHits=$('sbHits'), sbRank=$('sbRank'), goSubtitle=$('goLoreTeaser');

  // State
  const state={
    running:false, paused:false, gameover:false,
    t:0,last:0,score:0,best:0,lives:3,
    speed:180, spawnTimer:0, pixelSpawn:0,
    objects:[], orbs:[], pickups:[], particles:[], popups:[],
    dash:{cooldown:0,time:0},
    player:{x:W/2,y:H/2,r:12,hue:0},
    flash:0, shake:0,
    bombs:0, combo:1.0, comboTime:0,
    star:{active:false,time:0},
    stats:{orbs:0,bombsUsed:0,hits:0,maxCombo:1.0}
  };
  try{ state.best=Number(localStorage.getItem('pixelrunner_best')||0)}catch(e){}; bestEl.textContent=state.best;

  // Audio — refined
  const AudioCtx=window.AudioContext||window.webkitAudioContext; let ac;
  function ensureAudio(){ try{ ac=ac||new AudioCtx(); if(ac.state==='suspended') ac.resume(); }catch(e){} }
  function tone({freq=440,a='triangle',b='sine',detune=5,gain=0.06,dur=0.18,att=0.01,rel=0.12,lpfA=1800,lpfB=900,dmix=0.08,dt=0.14}={}){
    try{ ensureAudio(); const now=ac.currentTime;
      const o1=ac.createOscillator(), o2=ac.createOscillator(); o1.type=a; o2.type=b; o1.frequency.value=freq; o2.frequency.value=freq; o2.detune.value=detune;
      const m=ac.createGain(); const f=ac.createBiquadFilter(); f.type='lowpass'; f.frequency.setValueAtTime(lpfA,now); f.frequency.exponentialRampToValueAtTime(lpfB, now+dur);
      const g=ac.createGain(); g.gain.setValueAtTime(0,now); g.gain.linearRampToValueAtTime(gain,now+att); g.gain.setValueAtTime(gain, now+dur-rel); g.gain.linearRampToValueAtTime(0.0001, now+dur);
      const dL=ac.createDelay(1), dR=ac.createDelay(1); dL.delayTime.value=dt; dR.delayTime.value=dt*1.25; const mixL=ac.createGain(), mixR=ac.createGain(); mixL.gain.value=dmix; mixR.gain.value=dmix;
      o1.connect(m); o2.connect(m); m.connect(f).connect(g); g.connect(ac.destination); g.connect(mixL).connect(dL).connect(ac.destination); g.connect(mixR).connect(dR).connect(ac.destination);
      o1.start(); o2.start(); o1.stop(now+dur+.02); o2.stop(now+dur+.02);
    }catch(e){}}
  function softNoise({dur=0.18,cut=700,g=0.02}={}){
    try{ ensureAudio(); const now=ac.currentTime; const buf=ac.createBuffer(1,Math.max(1,Math.floor(dur*ac.sampleRate)),ac.sampleRate); const d=buf.getChannelData(0);
      for(let i=0;i<d.length;i++) d[i]=Math.random()*2-1;
      const src=ac.createBufferSource(); src.buffer=buf; const f=ac.createBiquadFilter(); f.type='lowpass'; f.frequency.value=cut; const gg=ac.createGain(); gg.gain.value=g;
      src.connect(f).connect(gg).connect(ac.destination); src.start(); src.stop(now+dur);
    }catch(e){}}
  const sfx={ dash:()=>tone({freq:640,a:'square',b:'triangle',dur:.10,gain:.06}), orb:()=>tone({freq:980,a:'triangle',b:'sine',dur:.09,gain:.055,detune:6}),
              life:()=>tone({freq:660,a:'triangle',b:'sine',dur:.12,gain:.06}), bombPickup:()=>tone({freq:520,a:'sine',b:'triangle',dur:.10,gain:.06}),
              hit:()=>tone({freq:220,a:'sawtooth',b:'sine',dur:.12,gain:.06,lpfA:1200,lpfB:600}), star:()=>{
              // Stop any previous star loop first
              if(state.star.loop) { try{ clearInterval(state.star.loop); }catch(e){} state.star.loop=null; }

              const melody = [
                {freq:880, dur:0.16},   // A5
                {freq:1175, dur:0.16},  // D6
                {freq:1319, dur:0.18},  // E6
                {freq:1567, dur:0.20},  // G6
              ];
              let idx = 0;
              // play next note in the pattern every ~180ms
              state.star.loop = setInterval(()=>{
                const n = melody[idx % melody.length];
                tone({
                  freq:n.freq,
                  a:'square',
                  b:'triangle',
                  dur:n.dur,
                  gain:0.07,
                  detune:4,
                  lpfA:2400,
                  lpfB:1200
                });
                idx++;
              }, 180);
            },
              bombDet:()=>{ tone({freq:120,a:'sawtooth',b:'sine',dur:.22,gain:.08}); setTimeout(()=>tone({freq:90,a:'sawtooth',b:'sine',dur:.24,gain:.08}),80); softNoise({dur:.22,cut:800,g:.02}); },
              mega:()=>{ tone({freq:160,a:'sawtooth',b:'sine',dur:.24,gain:.09}); setTimeout(()=>tone({freq:110,a:'sawtooth',b:'sine',dur:.28,gain:.09}),80); softNoise({dur:.28,cut:900,g:.022}); } };

  // Utils
  const rand=(a,b)=>a+Math.random()*(b-a), clamp=(v,a,b)=>Math.max(a,Math.min(b,v)), d2=(a,b)=>{const dx=a.x-b.x,dy=a.y-b.y; return dx*dx+dy*dy};

  // Spawn limits and helper utilities to reduce on-screen clutter
  const limits = {
    orbs: 5,
    pickups: { bomb: 2, life: 1, star: 1 }
  };
  function countPickups(type){ return state.pickups.filter(p=>p.type===type).length; }
  function isSpawnClear(x,y,min=70){
    // Avoid spawning right on top of the player, other pickups, orbs
    if (Math.hypot(x-state.player.x, y-state.player.y) < min+30) return false;
    for (const p of state.pickups) if (Math.hypot(x-p.x, y-p.y) < min) return false;
    for (const o of state.orbs)    if (Math.hypot(x-o.x, y-o.y) < min) return false;
    return true;
  }


  // Legend icons
  function drawLegendIcons(){
    document.querySelectorAll('canvas[data-icon]').forEach(c=>{
      const l=c.getContext('2d'), w=c.width,h=c.height; l.clearRect(0,0,w,h);
      const px=(x,y,s,col)=>{l.fillStyle=col;l.fillRect(Math.round(x-s/2),Math.round(y-s/2),s,s)};
      const arrow=(x,y,ang,s,col)=>{l.save();l.translate(x,y);l.rotate(ang);l.fillStyle=col;const g=s/3,pat=[[1,0,0],[1,1,0],[1,1,1]];for(let gy=0;gy<3;gy++)for(let gx=0;gx<3;gx++)if(pat[gy][gx])l.fillRect(Math.round((gx-1)*g),Math.round((gy-1)*g),Math.ceil(g),Math.ceil(g));l.restore();};
      const type=c.dataset.icon;
      if(type==='orb'){px(w*.5,h*.5,14,'#ffd84d');px(w*.5-6,h*.5,4,'#ffeaa0');}
      else if(type==='spike'){arrow(w*.5,h*.5,0,18,'#ff5470');}
      else if(type==='bomb'){px(w*.5,h*.5,16,'#b686ff');px(w*.5-5,h*.5,4,'#d5c0ff');}
      else if(type==='star'){const colors=['#ff6b6b','#ffd93d','#6bff95','#6bd5ff','#b686ff'];for(let i=0;i<5;i++)px(w*.5+Math.cos(i*1.256)*8,h*.5+Math.sin(i*1.256)*8,6,colors[i%5]);px(w*.5,h*.5,6,'#fff');}
      else if(type==='player'){const s=6,hues=[210,300,30];for(let gy=-1;gy<=1;gy++)for(let gx=-1;gx<=1;gx++){const d=Math.abs(gx)+Math.abs(gy);const hue=hues[d%3];px(w*.5+gx*s,h*.5+gy*s,5,`hsl(${hue} 95% ${d===0?65:60}%)`)}};
    });
  }
  function resize(){ game.width=W*DPR; game.height=H*DPR; game.style.width=W+'px'; game.style.height=H+'px'; ctx.setTransform(DPR,0,0,DPR,0,0); logoTop.width=900; logoTop.height=90; tctx.setTransform(DPR,0,0,DPR,0,0); drawLegendIcons(); }
  resize(); addEventListener('resize', resize);

  // Overlay
  function setOverlay(mode){ const show=!!mode; overlay.setAttribute('aria-hidden', String(!show)); pauseCard.hidden=mode!=='pause'; gameoverCard.hidden=mode!=='gameover'; }

  // Title logo pixels
  const GRID=10, LOCK_EPS=2, LOCK_AT=0.98; const FONT={'P':["11110","10001","11110","10000","10000","10000","10000"],'I':["111","010","010","010","010","010","111"],'X':["10001","01010","00100","00100","01010","10001","10001"],'E':["11111","10000","11110","10000","10000","10000","11111"],'L':["10000","10000","10000","10000","10000","10000","11111"],'R':["11110","10001","11110","10100","10010","10001","10001"],'U':["10001","10001","10001","10001","10001","10001","01110"],'N':["10001","11001","10101","10011","10001","10001","10001"],' ':["0","0","0","0","0","0","0"]};
  const TITLE='PIXEL RUNNER';
  function buildBits(ctxW, grid){ const letters=TITLE.split(''); let cols=0,pad=2,glyphs=[]; for(const ch of letters){ const g=FONT[ch]||FONT[' ']; cols+=g[0].length+pad; glyphs.push(g);} cols-=pad; const totalW=cols*grid,totalH=7*grid; const ox=(ctxW-totalW)/2,oy=(90-totalH)/2; const bits=[]; let xcol=0; for(const g of glyphs){ const w=g[0].length,h=g.length; for(let y=0;y<h;y++)for(let x=0;x<w;x++){ if(g[y][x]==='1'){ const tx=ox+(xcol+x)*grid+grid/2, ty=oy+y*grid+grid/2; const hue=(x*18+y*26)%360; bits.push({x:Math.random()*ctxW,y:-80-Math.random()*200,tx,ty,hue,locked:false}); } } xcol+=w+pad; } return bits; }
  const intro={active:true,t:0,pulse:0,formed:false,bits:[]}; (function(){ const letters=TITLE.split(''); let cols=0,pad=2,glyphs=[]; for(const ch of letters){const g=FONT[ch]||FONT[' ']; cols+=g[0].length+pad; glyphs.push(g)} cols-=pad; const totalW=cols*GRID,totalH=7*GRID; const ox=(W-totalW)/2,oy=H*0.24-totalH/2; let xcol=0; for(const g of glyphs){ const w=g[0].length,h=g.length; for(let y=0;y<h;y++)for(let x=0;x<w;x++){ if(g[y][x]==='1'){ const tx=ox+(xcol+x)*GRID+GRID/2, ty=oy+y*GRID+GRID/2; const hue=(x*18+y*26)%360; intro.bits.push({x:Math.random()*W,y:-80-Math.random()*H,tx,ty,hue,locked:false}); } } xcol+=w+pad; } })();
  const topLogo={active:false,t:0,pulse:0,formed:false,bits:[]};

  // Stars
  const stars=Array.from({length:90},()=>({x:Math.random()*W,y:Math.random()*H,z:Math.random()*1.2+0.3}));
  function drawStars(dt){ ctx.save(); for(const s of stars){ s.x=(s.x-22*s.z*dt+W)%W; ctx.globalAlpha=0.12+s.z*0.18; ctx.fillStyle='#a9b8ff'; ctx.fillRect(Math.round(s.x),Math.round(s.y),2+s.z,2+s.z);} ctx.restore(); }

  // Spawners
  function spawnOrb(){
    if (state.orbs.length >= limits.orbs) return;
    const m=36;
    let tries=12;
    while(tries--){
      const x=rand(m,W-m), y=rand(m,H-m);
      if (isSpawnClear(x,y,60)) { state.orbs.push({x,y,s:12}); return; }
    }
  }
  function spawnSpike(){ const e=Math.floor(rand(0,4)); let x,y,vx,vy; const s=rand(70,120)+state.t*0.02; if(e===0){x=-30;y=rand(0,H);vx=s;vy=rand(-40,40);} if(e===1){x=W+30;y=rand(0,H);vx=-s;vy=rand(-40,40);} if(e===2){x=rand(0,W);y=-30;vx=rand(-40,40);vy=s;} if(e===3){x=rand(0,W);y=H+30;vx=rand(-40,40);vy=-s;} state.objects.push({x,y,vx,vy,s:10}); }
  function spawnPickup(){
    const m=40;
    const r=Math.random();
    let type = (r<0.60) ? 'bomb' : (r<0.80) ? 'life' : 'star';
    if (countPickups(type) >= limits.pickups[type]) return;

    // TTLs (seconds)
    const ttl = type==='star' ? 9.0 : type==='life' ? 10.0 : 14.0;

    let tries=12;
    while(tries--){
      const x=rand(m,W-m), y=rand(m,H-m);
      if (isSpawnClear(x,y,70)) {
        state.pickups.push({x,y,s:14,type,ttl});
        return;
      }
    }
  }
  
  // FX
  function emit(x,y,color,count=10,spread=120,size=3){ for(let i=0;i<count;i++) state.particles.push({x,y,vx:rand(-spread,spread),vy:rand(-spread,spread),life:rand(.4,.9),color,size}); }
  function emitPixel(x,y,hue,count=14){ for(let i=0;i<count;i++){ const ang=Math.random()*Math.PI*2, sp=rand(60,320); const vx=Math.cos(ang)*sp,vy=Math.sin(ang)*sp; state.particles.push({x,y,vx,vy,life:rand(.5,1.4),color:`hsl(${(hue+rand(-30,30))%360} 95% 60%)`,size:4}); } }
  function megaExplosion(x,y){ state.flash=1; state.shake=22; sfx.mega(); for(let r=0;r<6;r++){ const baseHue=r*60; for(let k=0;k<80;k++){ const a=Math.random()*Math.PI*2, R=r*22+rand(-8,8); emitPixel(x+Math.cos(a)*R, y+Math.sin(a)*R, baseHue,1);} } for(let i=0;i<6;i++) emitPixel(x,y,i*60,90); }

  // Input
  const keys=new Set(); function readInput(){ let x=0,y=0; if(keys.has('arrowleft')||keys.has('a'))x--; if(keys.has('arrowright')||keys.has('d'))x++; if(keys.has('arrowup')||keys.has('w'))y--; if(keys.has('arrowdown')||keys.has('s'))y++; return {x,y,dash:keys.has('shift')}; }
  addEventListener('keydown',e=>{ if(['ArrowUp','ArrowDown','ArrowLeft','ArrowRight',' '].includes(e.key)) e.preventDefault(); keys.add(e.key.toLowerCase()); if(intro.active){ ensureAudio(); startGameFromIntro(); return; } if(e.key.toLowerCase()==='p'){ if(state.running){ state.paused=!state.paused; setOverlay(state.paused?'pause':null);} } if(e.key.toLowerCase()==='r'){ if(!state.running||state.paused||state.gameover){ reset(); } } if(e.key===' ' && state.running && state.bombs>0){ detonateBomb(state.player.x,state.player.y); } });
  addEventListener('keyup',e=>keys.delete(e.key.toLowerCase()));

  // Buttons
  startBtn.addEventListener('click',()=>{ ensureAudio(); if(intro.active){ startGameFromIntro(); } else if(!state.running){ reset(); } });
  resumeBtn.addEventListener('click',()=>{ if(state.paused){ state.paused=false; setOverlay(null); }});
  restartFromPauseBtn.addEventListener('click',()=>{ reset(); setOverlay(null); });
  playAgainBtn.addEventListener('click',()=>{ reset(); setOverlay(null); });
  instBtn.addEventListener('click',()=>{ const open=!instPanel.classList.contains('open'); instPanel.classList.toggle('open',open); instBtn.setAttribute('aria-expanded',String(open)); if(open) lorePanel.classList.remove('open'), loreBtn.setAttribute('aria-expanded','false'); });
  closeInst.addEventListener('click',()=>{ instPanel.classList.remove('open'); instBtn.setAttribute('aria-expanded','false'); });
  loreBtn.addEventListener('click',()=>{ const open=!lorePanel.classList.contains('open'); lorePanel.classList.toggle('open',open); loreBtn.setAttribute('aria-expanded',String(open)); if(open) instPanel.classList.remove('open'), instBtn.setAttribute('aria-expanded','false'); });
  closeLore.addEventListener('click',()=>{ lorePanel.classList.remove('open'); loreBtn.setAttribute('aria-expanded','false'); });

  // Game control
  function reset(){
    state.t=0; state.last=0; state.score=0; state.lives=3; state.speed=180;
    state.objects.length=0; state.orbs.length=0; state.pickups.length=0; state.particles.length=0; state.popups.length=0;
    state.flash=0; state.shake=0; state.gameover=false; state.combo=1.0; state.comboTime=0; state.pixelSpawn=0;
    state.player.x=W/2; state.player.y=H/2; state.bombs=0; state.star.active=false; state.star.time=0;
    if(state.star.loop){ try{ clearInterval(state.star.loop); }catch(e){} state.star.loop=null; }
    state.stats={orbs:0,bombsUsed:0,hits:0,maxCombo:1.0};
    bombsEl.textContent=state.bombs; comboEl.textContent='x'+state.combo.toFixed(1); starEl.textContent='—';
    spawnOrb(); spawnOrb();
    scoreEl.textContent='0'; livesEl.textContent='3'; timeEl.textContent='0.0s';
    state.spawnTimer=0; state.paused=false; state.running=true; setOverlay(null);
    legendPanel.classList.add('in');
  }
  function startGameFromIntro(){ intro.active=false; introUI.hidden=true; for(const b of intro.bits){ emitPixel(b.tx,b.ty,b.hue,6); } state.flash=0.8; state.shake=14; initTopLogo(); reset(); }
  function endGame(){
    state.running=false; state.gameover=true; megaExplosion(state.player.x,state.player.y);
    const t = state.t.toFixed(1)+'s';
    if(state.score>state.best){ state.best=state.score; try{localStorage.setItem('pixelrunner_best',String(state.best))}catch(e){} }
    bestEl.textContent=state.best;
    sbScore.textContent=state.score; sbBest.textContent=state.best; sbTime.textContent=t; sbCombo.textContent='x'+state.stats.maxCombo.toFixed(1);
    sbOrbs.textContent=state.stats.orbs; sbBombs.textContent=state.stats.bombsUsed; sbHits.textContent=state.stats.hits;
    sbRank.textContent = rankForScore(state.score,state.stats);
    legendPanel.classList.remove('in');
    setOverlay('gameover');
  }
  function rankForScore(s,st){ if(s>=1200||st.maxCombo>=4.5) return 'Archivist’s Ace'; if(s>=800) return 'Neon Courier'; if(s>=500) return 'Arrow Dodger'; if(s>=250) return 'Street Runner'; return 'Pixel Newcomer'; }

  function detonateBomb(cx,cy){
    if(state.bombs<=0) return;
    state.bombs--; state.stats.bombsUsed++; bombsEl.textContent=state.bombs;
    pillBombs.classList.add('flash'); setTimeout(()=>pillBombs.classList.remove('flash'),350);
    state.flash=1; state.shake=18; sfx.bombDet();
    const R = state.star.active?220:160; let removed=0;
    state.objects = state.objects.filter(s=>{ const d=Math.hypot(s.x-cx,s.y-cy); if(d<R){ emitPixel(s.x,s.y,rand(0,360),40); removed++; return false; } return true; });
    for(let k=0;k<6;k++) emitPixel(cx,cy,k*60,80);
    if(removed>0) addPopup(cx,cy-20,`Cleared ${removed}`,'#66e0ff');
  }

  // Draw helpers
  function px(x,y,s,c){ ctx.fillStyle=c; ctx.fillRect(Math.round(x-s/2),Math.round(y-s/2),s,s); }
  function arrow(x,y,a,size,c){ ctx.save(); ctx.translate(x,y); ctx.rotate(a); ctx.fillStyle=c; const s=size/3,pat=[[1,0,0],[1,1,0],[1,1,1]]; for(let gy=0;gy<3;gy++)for(let gx=0;gx<3;gx++)if(pat[gy][gx]) ctx.fillRect(Math.round((gx-1)*s),Math.round((gy-1)*s),Math.ceil(s),Math.ceil(s)); ctx.restore(); }
  function heart(x,y,u){ const m=[[0,1,0,1,0,0],[1,1,1,1,1,0],[1,1,1,1,1,0],[0,1,1,1,0,0],[0,0,1,0,0,0]]; for(let j=0;j<5;j++)for(let i=0;i<6;i++) if(m[j][i]) px(x+(i-2.5)*u,y+(j-2)*u,u,'#9cff57'); px(x-2*u,y-1.5*u,u,'#ccffab'); }
  function starAura(x,y){ const g=ctx.createRadialGradient(x,y,8,x,y,38); g.addColorStop(0,'rgba(255,255,255,.45)'); g.addColorStop(1,'rgba(255,255,255,0)'); ctx.fillStyle=g; ctx.beginPath(); ctx.arc(x,y,38,0,Math.PI*2); ctx.fill(); }

  // Popups
  function addPopup(x,y,text,color){ state.popups.push({x,y,vy:-30,life:1.0,text,color}); }

  // Top logo
  function initTopLogo(){ topLogo.bits = buildBits(900,8); topLogo.bits.forEach(b=>{ b.x=Math.random()*900; b.y=-50-Math.random()*120; b.locked=false;}); topLogo.active=true; topLogo.t=0; topLogo.pulse=0; topLogo.formed=false; }
  function drawTopLogo(dt){
    if(!topLogo.active){ tctx.clearRect(0,0,900,90); return; }
    tctx.setTransform(DPR,0,0,DPR,0,0); tctx.clearRect(0,0,900,90);
    topLogo.t+=dt; topLogo.pulse+=dt; let locked=0; const amp=1.8,spd=2.2,wl=22;
    for(const b of topLogo.bits){
      if(!b.locked){ const dx=b.tx-b.x, dy=b.ty-b.y; const d=Math.hypot(dx,dy); if(d>LOCK_EPS){ const k=Math.min(1,dt*5); b.x+=dx*k; b.y+=dy*k; } else { b.x=b.tx; b.y=b.ty; b.locked=true; } }
      if(b.locked) locked++;
      const hue=(b.hue + (b.locked? topLogo.pulse*16 : topLogo.pulse*40))%360; let yoff=0;
      if(topLogo.formed) yoff=Math.round(Math.sin((b.tx/wl)+topLogo.pulse*spd)*amp);
      const sz=8; tctx.fillStyle=`hsl(${hue} 97% 62%)`; tctx.fillRect(Math.round(b.x)-(sz>>1), Math.round(b.y+yoff)-(sz>>1), sz, sz);
    }
    const frac=locked/topLogo.bits.length; if(!topLogo.formed && frac>=LOCK_AT){ topLogo.formed=true; }
    const cx=450,cy=45; const g=tctx.createRadialGradient(cx,cy,20,cx,cy,220); g.addColorStop(0,'rgba(102,224,255,0.18)'); g.addColorStop(1,'rgba(102,224,255,0)'); tctx.fillStyle=g; tctx.beginPath(); tctx.arc(cx,cy,220,0,Math.PI*2); tctx.fill();
  }

  // Main loop
  function loop(ts){
    requestAnimationFrame(loop);
    if(!state.last) state.last=ts; const dt=Math.min(0.033,(ts-state.last)/1000); state.last=ts;
    ctx.setTransform(DPR,0,0,DPR,0,0); ctx.clearRect(0,0,W,H);
    let sx=0, sy=0; if(state.shake>0){ const mag=state.shake*.6; sx=(Math.random()*2-1)*mag; sy=(Math.random()*2-1)*mag; state.shake=Math.max(0,state.shake-60*dt); } ctx.translate(sx,sy);

    if(intro.active){
      drawStars(dt); intro.t+=dt; intro.pulse+=dt; let locked=0;
      for(const b of intro.bits){ if(!b.locked){ const dx=b.tx-b.x, dy=b.ty-b.y; const d=Math.hypot(dx,dy); if(d>LOCK_EPS){ const k=Math.min(1,dt*5); b.x+=dx*k; b.y+=dy*k; } else { b.x=b.tx; b.y=b.ty; b.locked=true; } } if(b.locked) locked++; px(b.x,b.y,GRID,`hsl(${(b.hue + (b.locked? intro.pulse*20:intro.pulse*60))%360} 97% 62%)`); }
      ctx.fillStyle='rgba(230,241,255,0.95)'; ctx.font='bold 18px Segoe UI, system-ui, sans-serif'; ctx.textAlign='center'; ctx.fillText('Press any key or Play to start', W/2, H*0.58);
      drawTopLogo(0); return;
    }

    drawTopLogo(dt);
    if(state.paused){ drawStars(dt); return; }
    drawStars(dt);

    if(state.running){
      state.t+=dt; timeEl.textContent=state.t.toFixed(1)+'s';
      state.spawnTimer-=dt; if(state.spawnTimer<=0){ spawnSpike(); state.spawnTimer=Math.max(0.22,1.1 - state.t*0.04); }
      state.pixelSpawn-=dt;
      if(state.pixelSpawn<=0){
        if(Math.random()<0.5) spawnOrb(); else spawnPickup();
        // slightly slower baseline; scales with time to avoid clutter
        state.pixelSpawn = rand(1.2, 2.0) - Math.min(0.5, state.t*0.01);
      }
      if(state.t>5 && state.score<120 && state.bombs===0 && !state.pickups.some(p=>p.type==='bomb') && countPickups('bomb') < limits.pickups.bomb){
        state.pickups.push({x:rand(60,W-60),y:rand(60,H-60),s:14,type:'bomb', ttl:14.0});
      }

      const i=readInput(); const dash=i.dash && state.dash.cooldown<=0; const spd = state.speed * (dash?1.8:1) * (state.star.active?1.35:1);
      if(dash){ state.dash.cooldown=1.1; state.dash.time=0.18; emit(state.player.x,state.player.y,'#22d3ee',12); sfx.dash(); }
      if(state.dash.cooldown>0) state.dash.cooldown-=dt; if(state.dash.time>0) state.dash.time-=dt;
      const len=Math.hypot(i.x,i.y)||1, nx=i.x/len, ny=i.y/len; state.player.x=clamp(state.player.x + nx*spd*dt,10,W-10); state.player.y=clamp(state.player.y + ny*spd*dt,10,H-10);
      state.player.hue=(state.player.hue+120*dt*(state.star.active?2:1))%360;

      if(state.star.active){ state.star.time-=dt; starEl.textContent=state.star.time.toFixed(1)+'s'; if(state.star.time<=0){
        state.star.active=false;
        starEl.textContent='—';
        if(state.star.loop){ try{ clearInterval(state.star.loop); }catch(e){} state.star.loop=null; }
      } for(const s of state.objects){ if(Math.hypot(s.x-state.player.x,s.y-state.player.y)<40) s.x=-9999; } state.objects=state.objects.filter(s=>s.x>-900); }

      for(let k=state.orbs.length-1;k>=0;k--){ const o=state.orbs[k]; if(d2(o,state.player) < (o.s/2+state.player.r)**2){ state.orbs.splice(k,1); const pts=Math.round(10*state.combo); state.score+=pts; state.combo=Math.min(5, state.combo+0.1); state.stats.maxCombo=Math.max(state.stats.maxCombo,state.combo); state.comboTime=2.5; state.stats.orbs++; state.speed+=6; emit(o.x,o.y,'#ffd84d',16); addPopup(o.x,o.y-10,'+'+pts, '#ffd166'); scoreEl.textContent=state.score; comboEl.textContent='x'+state.combo.toFixed(1); spawnOrb(); sfx.orb(); } }
      if(state.combo>1){ state.comboTime-=dt; if(state.comboTime<=0){ state.combo=Math.max(1, state.combo-0.1); state.comboTime=0.4; comboEl.textContent='x'+state.combo.toFixed(1);} }

      for(let k=state.pickups.length-1;k>=0;k--){
      const p=state.pickups[k];

      // TTL countdown + despawn FX
      if (p.ttl !== undefined) {
        p.ttl -= dt;
        if (p.ttl <= 0){
          emit(p.x,p.y, p.type==='star' ? '#ffd93d' : p.type==='life' ? '#9cff57' : '#b686ff', 12);
          state.pickups.splice(k,1);
          continue;
        }
      }

      // Collect
      if(d2(p,state.player) < (p.s/2+state.player.r)**2){
        if(p.type==='bomb'){
          state.bombs++; bombsEl.textContent=state.bombs; emit(p.x,p.y,'#b686ff',24); sfx.bombPickup();
          pillBombs.classList.add('flash'); setTimeout(()=>pillBombs.classList.remove('flash'),350);
          addPopup(p.x,p.y-10,'+Bomb','#bfa6ff');
        } else if(p.type==='life'){
          if(state.lives<5){
            state.lives++; livesEl.textContent=state.lives; pillLives.classList.add('flash'); setTimeout(()=>pillLives.classList.remove('flash'),350);
          }
          emit(p.x,p.y,'#9cff57',24); sfx.life(); addPopup(p.x,p.y-10,'+1 Life','#9cff57');
        } else if(p.type==='star'){
          state.star.active=true; state.star.time=6.0; starEl.textContent=state.star.time.toFixed(1)+'s'; emitPixel(p.x,p.y,0,90); sfx.star();
        }
        state.pickups.splice(k,1);
      }
    }

      for(const s of state.objects){ s.x+=s.vx*dt; s.y+=s.vy*dt; } state.objects=state.objects.filter(s=> s.x>-60&&s.x<W+60&&s.y>-60&&s.y<H+60);
      for(let k=state.objects.length-1;k>=0;k--){ const s=state.objects[k]; if(d2(s,state.player) < (s.s+state.player.r)**2){ if(state.star.active){ emitPixel(s.x,s.y,rand(0,360),30); addPopup(s.x,s.y-10,'ZAP!','#66e0ff'); state.objects.splice(k,1); state.score+=5; scoreEl.textContent=state.score; } else { state.objects.splice(k,1); state.lives--; livesEl.textContent=state.lives; state.stats.hits++; emit(state.player.x,state.player.y,'#ff5470',22); sfx.hit(); addPopup(state.player.x,state.player.y-14,'-1 Life','#ff5470'); pillLives.classList.add('flash'); setTimeout(()=>pillLives.classList.remove('flash'),350); if(state.lives<=0){ endGame(); } } } }
    }

    // Render
    for(const o of state.orbs) px(o.x,o.y,o.s,'#ffd84d');
    for(const p of state.pickups){
      // Blink in the last 3s for life/star
      let alpha = 1;
      if ((p.type==='life' || p.type==='star') && p.ttl !== undefined && p.ttl < 3){
        alpha = 0.5 + 0.5 * Math.sin(state.t*10);
      }
      ctx.save(); ctx.globalAlpha = alpha;

      if(p.type==='bomb'){
        px(p.x,p.y,p.s,'#b686ff'); px(p.x-4,p.y,4,'#d5c0ff');
      } else if(p.type==='life'){
        heart(p.x,p.y,4);
      } else if(p.type==='star'){
        const colors=['#ff6b6b','#ffd93d','#6bff95','#6bd5ff','#b686ff'];
        for(let i=0;i<5;i++) px(p.x+Math.cos(i*1.256)*6,p.y+Math.sin(i*1.256)*6,4,colors[i%5]);
        px(p.x,p.y,4,'#fff');
      }

      ctx.restore();

      // Small numeric countdown for life/sta
      if ((p.type==='life' || p.type==='star') && p.ttl !== undefined){
        ctx.save();
        ctx.font='bold 12px Segoe UI, system-ui, sans-serif';
        ctx.textAlign='center';
        ctx.fillStyle = 'rgba(230,241,255,0.9)';
        ctx.fillText(Math.ceil(p.ttl), p.x, p.y - 16);
        ctx.restore();
      }
    }
    for(const s of state.objects) arrow(s.x,s.y,Math.atan2(s.vy,s.vx),18,'#ff5470');

    for(let i=state.particles.length-1;i>=0;i--){ const pr=state.particles[i]; pr.life-=dt; if(pr.life<=0){ state.particles.splice(i,1); continue; } pr.x+=pr.vx*dt; pr.y+=pr.vy*dt; pr.vx*=0.96; pr.vy*=0.96; ctx.globalAlpha=Math.max(0,pr.life); ctx.fillStyle=pr.color; ctx.fillRect(pr.x,pr.y,pr.size||3,pr.size||3); ctx.globalAlpha=1; }

    ctx.save(); ctx.font='bold 16px Segoe UI, system-ui, sans-serif'; ctx.textAlign='center';
    for(let i=state.popups.length-1;i>=0;i--){ const pb=state.popups[i]; pb.life-=dt; pb.y+=pb.vy*dt; if(pb.life<=0){ state.popups.splice(i,1); continue; } ctx.globalAlpha=Math.max(0,pb.life); ctx.fillStyle=pb.color; ctx.fillText(pb.text,pb.x,pb.y); ctx.globalAlpha=1; } ctx.restore();

    const uu=6,hues=[state.player.hue,(state.player.hue+90)%360,(state.player.hue+180)%360];
    for(let gy=-1;gy<=1;gy++) for(let gx=-1;gx<=1;gx++){ const d=Math.abs(gx)+Math.abs(gy); const col=`hsl(${hues[d%3]} 95% ${d===0?65:60}%)`; px(state.player.x+gx*uu,state.player.y+gy*uu,5,col); }
    if(state.star.active){ starAura(state.player.x,state.player.y); if(Math.random()<0.6) emitPixel(state.player.x,state.player.y,rand(0,360),2); }
    if(state.flash>0){ state.flash=Math.max(0,state.flash-1.8*dt); ctx.save(); ctx.globalAlpha=state.flash*0.9; ctx.fillStyle='#fff'; ctx.fillRect(0,0,W,H); ctx.restore(); }
  }
  requestAnimationFrame(loop);

  // Self-tests
  (function(){ try{ console.group('%cPixel Runner self-tests','color:#66e0ff'); console.assert(typeof state==='object','state exists'); let life=0,bomb=0,star=0; for(let i=0;i<1000;i++){ const r=Math.random(); if(r<0.6) bomb++; else if(r<0.8) life++; else star++; } console.assert(bomb>life && bomb>star,'bombs favored'); console.assert(life/1000>=0.15 && life/1000<=0.25,'life ~20%'); console.groupEnd(); }catch(e){ console.error(e);} })();
})(); 


</script>
</body>
</html>
